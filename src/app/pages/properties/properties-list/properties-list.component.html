<div class="ui-page ui-page-fit">

  <app-page-header
    title="Propriedades"
    subtitle="Gerencie as propriedades cadastradas e seus canais conectados."
    [sticky]="true"
    [top]="16"
  >
    <button class="ui-btn primary solid" type="button" (click)="goNew()">
      <span class="material-symbols-rounded">add</span>
      Nova propriedade
    </button>
  </app-page-header>

  <!-- ✅ FILTRO SOLTO + TOGGLE -->
  <app-filter-panel title="Filtros" [defaultOpen]="false" [activeCount]="activeFiltersCount()">

    <div filterActions>
      <button class="ui-btn ghost mini" type="button" (click)="clearFilters()">
        Limpar
      </button>
    </div>

    <div class="ui-filters" [formGroup]="filterForm">
      <div class="ui-field grow">
        <label>Buscar</label>
        <input formControlName="query" placeholder="Nome, cidade..." />
      </div>

      <div class="ui-field">
        <label>País</label>
        <select formControlName="country">
          <option value="">Todos</option>
          <option value="BR">Brasil</option>
          <option value="US">Estados Unidos</option>
          <option value="PT">Portugal</option>
        </select>
      </div>
    </div>
  </app-filter-panel>

  <!-- ✅ BODY: ocupa o resto da altura -->
  <div class="ui-page-body">

    <app-table-card
      class="ui-table-card"
      title="Propriedades cadastradas"
      [hasRows]="rows().length > 0"
      [loading]="loading()"
    >
      <div tableContent class="ui-table-stack">

        <!-- ✅ HEADER FIXO -->
        <table class="ui-table ui-table-head">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Local</th>
              <th>País</th>
              <th>Status</th>
              <th>Criada em</th>
              <th class="ui-center">Ações</th>
            </tr>
          </thead>
        </table>

        <div class="ui-table-body-scroll">
          <table class="ui-table ui-table-body">
            <tbody>
              <tr *ngFor="let row of rows()" [class.ui-row-inactive]="!row.active">
                <td class="ui-td-muted">{{ row.name }}</td>
                <td class="ui-td-muted">
                  {{ row.city }}<span *ngIf="row.state"> - {{ row.state }}</span>
                </td>
                <td class="ui-td-muted">{{ row.country }}</td>
                <td>
                  <span class="badge" [class.success]="row.active" [class.warning]="!row.active">
                    {{ row.active ? 'Ativa' : 'Inativa' }}
                  </span>
                </td>
                <td class="ui-td-muted">
                  {{ row.createdAt | date:'dd/MM/yyyy' }}
                </td>
                <td class="ui-right ui-actions-cell">
                  <button class="ui-icon-btn" title="Editar" type="button" (click)="edit(row.publicId)">
                    <span class="material-symbols-rounded">edit</span>
                  </button>

                  <button class="ui-icon-btn warning" title="Ativar/Inativar" type="button" (click)="toggleActive(row)">
                    <span class="material-symbols-rounded">
                      {{ row.active ? 'pause_circle' : 'play_circle' }}
                    </span>
                  </button>

                  <button class="ui-icon-btn danger" title="Excluir" type="button" (click)="remove(row)">
                    <span class="material-symbols-rounded">delete</span>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div tableFooter>
        <app-pagination
          [vm]="paginationVm()"
          [disabled]="loading()"
          [sizeOptions]="[5, 10, 20]"
          (pageChange)="onPageChange($event)"
          (sizeChange)="onSizeChange($event)"
        >
        </app-pagination>
      </div>

    </app-table-card>

  </div>
</div>
